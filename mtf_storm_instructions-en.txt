===========================
MTF -Storm quick start guide
===========================
MTF-Storm[2] extends MTF [1] introducing novel techniques and methods in the selection of values and the format
alteration techniques. MTF-Storm adopts a systematic approach to exercise values of packet fields and format
changes, in contrast to the random values and changes used by MTF. 

MTF-Storm is implemented based on the MTF software,i.e. it is implemented in Python and employs the modbus-tk (available at https://code.google.com/archive/p/modbus-tk/)
open source Modbus protocol implementation in Python,
pymodbus (available at https://github.com/riptideio/pymodbus ),scapy (available at https://github.com/secdev/scapy ) and Sulley (available at https://github.com/OpenRCE/sulley   ) to generate valid Modbus/TCP frames and manage the master/slave connectivity.
For the generation of tests that include combinations of fields, MTF-Storm uses the tools NIST ACTS (available at https://csrc.nist.gov/Projects/automated-combinatorial-testing-for-software/downloadable-tools) and AllPairs 2.0.1 (available at https://pypi.org/project/AllPairs/2.0.1/) 

See related work:
[1] A.G. Voyiatzis, K. Katsigiannis and S. Koubias, “A Modbus/TCP
Fuzzer for testing internetworked industrial systems.” In Proceedings of
the 20th IEEE International Conference on Emerging Technologies and
Factory Automation (ETFA), Luxembourg, Sept. 8-11, 2015, pp. 1-6.

[2]Katsigiannis K, and Dimitrios Serpanos. "MTF-Storm: a high performance fuzzer for Modbus/TCP." 
2018 IEEE 23rd International Conference on Emerging Technologies and Factory Automation (ETFA). Vol. 1. IEEE, 2018.

MTF-Storm:Source code for Modbus/TCP fuzzer used for ETFA 2018 paper [2]

Linux Pre-requisites:
Installation:
1.Python 2.7.3 installed 

2.modbus-tk-0.4.2 installed
pip install modbus_tk==0.4.2

3.Install scapy 2.4.0 library
pip install scapy

4.pip install coloredlogs

5.pip install AllPairs

6.e.g git clone https://github.com/git/git
  copy to /home/user/MTF_STORM

7.From /home/user/MTF_STORM, run script mtf.py with the following parameters:
	python mtf.py -i <host>  -s <search_mode> -z <fuzz_mode> -f <csvFile=search.csv> -p <pcap_file=packets.pcap> -t <suite test> -r <normal_request>'
	 
	host            - the IP of the remote machine (under test)
	csvFile         - stores search information
	pcap_file       - trace pcap file 
	normal_reguest  - number of requests for every FC found during the identification phase (default=1000)
	suite test = [('test_MBAP', 1), ('test_message_PDU', 2), ('test_field_PDU', 3),('Not_fuzz',4)]
	
I. python mtf.py -i 192.168.Χ.Χ -s -f, identification process, where 192.168.Χ.Χ is the IP address of the device or software with open port 502
    Output:
	a) generation of a file with name "search.csv". The file contains the list of supported FC and addressed of the device or software
	under test.
	b) generation of a file with name "dump_memory.csv", storing information for the dump memory attack (retrieve information regarding
	the memory locations of the remote machine (SUT) (Address 0x Value READ_COILS", "Address 3x Value READ_INPUT_REGISTERS" etc.
	c) generation of log files with name format "info_Y_m_d_H_M_S.log" (Year_Month_Day_Hour_Minute_Second.log) and
	"error_Y_m_d_H_M_S.log" containing information about the executed transactions during the identification phase.

II. python mtf.py -i 192.168.Χ.Χ -s -f -p, identification phase based on pcap files. A "search.csv" file is generated as in I.
	The file contains the list of supported FC and addresses based on the traffic read from the pcap file
	(if option -z and - t <suite test> is given, then mtf.py starts automatically the fuzzing process as well).

III.python mtf.py -i 192.168.Χ.Χ  -z -f -t 2 fuzzing process (phase 2), assumes that the file "search.csv" already exists
    (generated by phase 1 of I above).(<-t 2> test_message_PDU)

IV. python mtf.py -i 192.168.Χ.Χ -s -z -f -t 3, identification process (phase 1) and then fuzzing (phase 2), (test field_PDU)
    Output:
	a) generation of log files with name format "info_Y_m_d_H_M_S.log" (Year_Month_Day_Hour_Minute_Second.log) and
	"error_Y_m_d_H_M_S.log" containing information about the executed transactions (requests-responses) and errors.
	b) generated files as I.a and I.b above.
	
IVV. python mtf.py -i 192.168.Χ.Χ  -z -f -t 4 -r 300, send 300 normal request (not fuzz) in the list of supported FC, with random valid value in PDU fields	
	
INFO: 
Defaults directory ./ 'install dir' -- such as MTF_STORM
 ./           -- save search.csv (FC support and address  and dump_memory.csv (map address table), csv file after search mode (reconnaissance)
log_dir=./log -- path log file,save log files, 

log_dir=./log -defaults dir save log files and statistics, Coverage report, case valid/invalid, cov % , tuples of test value
/tmp/def save dir .csv from AllPairs 2.0.1 PAIRWISE test -create for FC01-FC04.. 
/Nist-csv
csv file from ACTS Test Suite Generation PAIRWISE  test for FC 15,16,20,21,23,43 and mbap.csv
/Allpairs_201-csv
some csv file and script from AllPairs 2.0.1 
/utils 
some utils script
/txt 
some instructions-en
/reconnaissance
some results from reconnaissance
/Coverage report
some results from statistics, Coverage,  tuples of test value


